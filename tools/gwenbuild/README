
GwenBuild
=========

GwenBuild is yet another build system.

"autotools" (automake, autoconf) are really cool and they work in almost every case as expected.
However, they are extremely slow which is a problem with larger projects containing many source files
and convenience libraries. Also, they are hard to debug if you encounter unusual problems, e.g. in AqBanking
we have the problem that sometimes not all sources/convenience libraries are correctly rebuilt after source code
changes and up to now I have no idea why that is.

A nice solution would be to switch to "cmake", especially when using their build target "ninja" which is
astonishingly fast. "cmake" is quite easy to setup for simple projects, however, it is not that easy to change larger projects 
to use it. Also, there is quite a steep learning curve.

"meson" is another good alternative since it also uses "ninja" and is therefore also extremely fast. But I wasn't able to
adapt my projects to use "meson" because some features I needed for e.g. AqFinance or AqBanking required a version of "meson" newer 
than what is provided by the distribution I'm currently working with.

Out of curiosity "gwenbuild" was started. I wanted to see how fast a build system can be and how hard it would be to write one.
Gwenbuild is a tool inside the library gwenhywfar, which is a base library for all my projects. Therefore it is always available in 
the required version for depending projects. Gwenhywfar itself will not be ported to use this build system to avoid the 
hen-and-egg-problem.


The following major goals were identified before development started:
- needs to be much faster than autotools/make
- needs to provide library, header and function search functions
- needs to be able to generate a "config.h" file
- needs to be able to rewrite files by replacing placeholders in source files (like "sed" does in ./configure)
- needs to be simple to setup
- needs to have support for typemaker2 source files
- needs to allow out-of-source build
- should be easy to extend
- should handle dependency trees



QuickStart for Users
--------------------

- create a new folder in which to build, there:
- "gwbuild PATH_TO_SOURCE_FOLDER"
- "gwbuild -p"
- "gwbuild -B tm2builder" (sometimes needed explicitly)
- "gwbuild -jMAX_NUMBER_OF_PARALLEL_JOBS"

After changing source files only the last step needs to be repeated.



QuickStart for Development
--------------------------

- builder (modules which generate commands to compile or link source files) are defined in XML files in "builders/" (see *.gwb files).
- new builders should be added in file "gwenbuild.c" in functions "_genBuilderForSourceFile()" and "_genBuilderForTarget()" at
  the bottom of that file.



Current Status
--------------

gwenbuild is now able to compile C and C++ files, link shared libraries and temporary convenience libraries and generate source files
from typemaker2 type description files. It also handles dependencies and custom build commands (like for XML merge) can now be defined
which can also use gwenbuild's dependency handling.

It can build using multiple processes in parallel. Compiling and linking AqBanking using 14 processes in parallel takes about 9 secs on 
my machine now.




Some notes to myself
====================

https://docencia.ac.upc.edu/FIB/USO/Bibliografia/unix-c-libraries.html


Build dependecies:
   cc -E -I INCLUDE_FOLDER -M -MF DEPOUTFILE SRCFILE

or 
   $(CC) $(CFLAGS) -MM *.c > Makefile.deps
   

# shared lib:
gcc -shared -nostdlib -o libaqdiagram.so aqdiagram.o -lgwenhywfar -lgmp -Wl,--whole-archive draw/libaqdg_draw.a




TODO:
- dependency checking: check all input files (especially for <buildFiles>)
- INSTALL implementieren
- DIST implementieren (tarball bauen)
- CLEAN implementieren (einfach alle BUILT Dateien loeschen)
- shared vs. static
- internal commands (or flag: delete destination file before build)
