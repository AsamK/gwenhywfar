<!--
$RCSfile$
-----------------
cvs         : $Id$
begin       : Mon Oct 13 2003
copyright   : (C) 2003 by Martin Preuss
email       : martin@libchipcard.de
-->

<!--
 This file contains the segment/message descriptions for the HBCI protocol
 Author: Martin Preuss<martin@libchipcard.de>
 
 Please don't worry about the many comments inside this file, the XML-light
 code of LibGwenhywfar does not read comments when used by OpenHBCI ;-)
 But anyway, please make sure that a comment is less then 8192 bytes in
 length.
-->

<VERSIONINFO>
  <AUTHOR>Martin Preuss</AUTHOR>
  <DATE>20031105</DATE>
  <VERSION>
    <MAJOR>0</MAJOR>
    <MINOR>2</MINOR>
    <PATCHLEVEL>1</PATCHLEVEL>
  </VERSION>
</VERSIONINFO>


<GROUPS>
  <GROUPdef id="SegHead" delimiter=":" hide="1" >
    <!-- "Segmentkopf" -->
    <ELEM name="code" type="AN" maxsize="16" />
    <ELEM name="seq" type="num" maxsize="15" topdown="1" >
      <!-- Topdown="1" means: Definitions from higher levels overwrite
           definitions inside this group. Otherwise local definitions
           here overwrite those from higher levels.
      -->
    </ELEM>
    <ELEM name="version" type="num" maxsize="3"/>
    <ELEM name="ref" type="num" maxsize="3" minnum=0 />
    
    <VALUES>
      <!-- "+" means: use the given global property and post-increment it 
               You need to preset it before starting to create a message -->
      <VALUE path="seq" overwrite="0" >+SegmentNumber</VALUE>
    </VALUES>
  </GROUPdef>


  <GROUPdef id="kik" delimiter=":" version="1">
    <!-- "Kreditinstitutskennung" -->
    <ELEM name="country" type="num" maxsize="3" />
    <ELEM name="bankcode" type="ascii" maxsize="30" minnum="0" />
    <VALUES>
      <VALUE path="country">280</VALUE>
    </VALUES>
    
  </GROUPdef>


  <GROUPdef id="ktv" delimiter=":" version="1">
    <!-- "Kontoverbindung" -->
    <ELEM name="accountid" type="ascii" maxsize="20" />
    <GROUP type="kik" />
  </GROUPdef>

  
  <GROUPdef id="msgref" delimiter=":" version="1" >
    <!-- "Bezugsnachricht" -->
    <ELEM name="dialogId" type="ascii" maxsize="35" />
    <ELEM name="msgnum" type="num" maxsize="4" />
  </GROUPdef>


  <GROUPdef id="result" delimiter=":" version="1">
    <!-- Rueckmeldung -->
    <ELEM name="resultcode" type="num" maxsize="4" />
    <ELEM name="elementref" type="an" maxsize="7" minnum="0" />
    <ELEM name="text" type="an" maxsize="80" />
    <ELEM name="param" type="ascii" maxsize="35" minnum="0" maxnum="10" />
  </GROUPdef>


  <GROUPdef id="keyname" delimiter=":" version="1">
    <!-- Schluesselname -->
    <GROUP type="kik" />
    <ELEM name="userid" type="ascii" maxsize="35" trustlevel="3" />
    <ELEM name="keytype" type="alpha" maxsize="1" />
    <ELEM name="keynum" type="num" maxsize="3" />
    <ELEM name="keyversion" type="num" maxsize="3" />
  </GROUPdef>


  <GROUPdef id="SignKeyName" delimiter=":" version="1">
    <!-- Sign-Schluesselname -->
    <GROUP type="keyname" />

    <VALUES>
      <VALUE path="keytype">S</VALUE>
    </VALUES>
  </GROUPdef>


  <GROUPdef id="CryptKeyName" delimiter=":" version="1">
    <!-- Crypt-Schluesselname -->
    <GROUP type="keyname" />

    <VALUES>
      <VALUE path="keytype">V</VALUE>
    </VALUES>
  </GROUPdef>


  <GROUPdef id="secstamp" delimiter=":" version="1">
    <!-- Sicherheits-/ Gueltigkeitsdatum und -uhrzeit -->
    <ELEM name="stampcode" type="num" maxsize="1" />
    <ELEM name="date" type="date" minsize="8" maxsize="8" minnum="0" />
    <ELEM name="time" type="time" minsize="6" maxsize="6" minnum="0" />
  </GROUPdef>


  <GROUPdef id="cert" delimiter=":" version="1">
    <!-- Zertifikat -->
    <ELEM name="type" type="num" maxsize="1" />
    <ELEM name="cert" type="bin" maxsize="2048" />
  </GROUPdef>


  <GROUPdef id="key" delimiter=":" version="1">
    <!-- oeffentlicher Schluessel -->
    <ELEM name="purpose" type="num" maxsize="3" />
    <ELEM name="opmode" type="num" maxsize="3" />
    <ELEM name="type" type="num" maxsize="3" />
    <ELEM name="modulus" type="bin" maxsize="512" />
    <ELEM name="modname" type="num" maxsize="3" />
    <ELEM name="exponent" type="bin" maxsize="512" />
    <ELEM name="expname" type="num" maxsize="3" />
    
    <VALUES>
      <VALUE path="opmode">16</VALUE>
      <VALUE path="type">10</VALUE>
      <VALUE path="modname">12</VALUE>
      <VALUE path="expname">13</VALUE>
    </VALUES>
  </GROUPdef>

  
  <GROUPdef id="signkey" delimiter=":" version="1">
    <!-- oeffentlicher Signier-Schluessel -->
    <GROUP type="key" />
    
    <VALUES>
      <VALUE path="purpose">6</VALUE>
    </VALUES>
  </GROUPdef>


  <GROUPdef id="cryptkey" delimiter=":" version="1">
    <!-- oeffentlicher Crypt-Schluessel -->
    <GROUP type="key" />
    
    <VALUES>
      <VALUE path="purpose">5</VALUE>
    </VALUES>
  </GROUPdef>


  <GROUPdef id="HashAlgo" delimiter=":" version="1">
    <!-- Hash-Algo -->
    <ELEM name="purpose" type="an" maxsize="3" />
    <ELEM name="algo" type="an" maxsize="3" />
    <ELEM name="pname" type="an" maxsize="3" />
    <ELEM name="param" type="bin" maxsize="512" minnum="0" />
    
    <VALUES>
      <VALUE path="purpose">1</VALUE>
      <VALUE path="algo">999</VALUE>
      <VALUE path="pname">1</VALUE>
    </VALUES>
  </GROUPdef>


  <GROUPdef id="SignAlgoBase" delimiter=":" version="1">
    <!-- Signatur-Algo -->
    <ELEM name="purpose" type="an" maxsize="3" />
    <ELEM name="algo" type="an" maxsize="3" />
    <ELEM name="mode" type="an" maxsize="3" />

    <VALUES>
      <VALUE path="purpose">6</VALUE>
    </VALUES>
  </GROUPdef>


  <GROUPdef id="CryptAlgoBase" delimiter=":" version="1">
    <!-- Crypt-Algo -->
    <ELEM name="purpose" type="an" maxsize="3" />
    <ELEM name="mode" type="an" maxsize="3" />
    <ELEM name="algo" type="an" maxsize="3" />
    <ELEM name="MsgKey" type="bin" maxsize="512" />
    <ELEM name="KeyType" type="an" maxsize="3" />
    <ELEM name="pname" type="an" maxsize="3" />
    <ELEM name="param" type="bin" maxsize="512" minnum="0" />

    <VALUES>
      <VALUE path="purpose">2</VALUE>
      <VALUE path="mode">2</VALUE>
      <VALUE path="algo">13</VALUE>
      <VALUE path="pname">1</VALUE>
    </VALUES>
  </GROUPdef>



  <!-- RDH stuff -->
  
  <GROUPdef id="SignAlgo" delimiter=":" version="1" mode="RDH" >
    <!-- Signatur-Algo fuer RDH -->
    <GROUP type="SignAlgoBase" version="1" />

    <VALUES>
      <VALUE path="algo">10</VALUE>
      <VALUE path="mode">16</VALUE>
    </VALUES>
  </GROUPdef>



  <GROUPdef id="CryptAlgo" delimiter=":" version="1" mode="RDH" >
    <!-- Crypt-Algo fuer RDH -->
    <GROUP type="CryptAlgoBase" version="1" />

    <VALUES>
      <VALUE path="keytype">6</VALUE>
    </VALUES>
  </GROUPdef>

  <GROUPdef id="SecDetails" delimiter=":" version="1" mode="RDH" >
    <!-- Sicherheitsidentifikation, Details -->
    <ELEM name="dir" type="num" maxsize=3 />
    <ELEM type="an" addemptymode="none"/>
    <ELEM name="SecId" type="ascii" maxsize="256" minnum="1" />
  </GROUPdef>

</GROUPS>



 <!-- Segments -->
<SEGs>
 <!--
  --------------------------------------------------------------------
                       Administrative Segmente
  --------------------------------------------------------------------- 
 -->

  <SEGdef id="MsgHead" 
          code="GBHEAD" 
          version="2"
          pversion="1"
          delimiter="+" 
          terminator="'"
  >
    <!-- "Nachrichtenkopf" -->
    <GROUP type="SegHead" name="head" />
    <ELEM name="size" type="num" maxsize="12" leftfill="1" />
    <ELEM name="hversion" type="num" maxsize="3" />
    <ELEM name="dialogId" type="ascii" maxsize="128" />
    <ELEM name="msgnum" type="num" maxsize="4" />
    <GROUP type="msgref" name="msgref" minnum="0" version="1" 
           addemtpymode="none"/>
 
    <VALUES>
      <VALUE path="head/code">%code</VALUE>
      <VALUE path="head/version">%version</VALUE>
      <VALUE path="hversion">%pversion</VALUE>
      <VALUE path="msgnum">$MessageNumber</VALUE>
      <VALUE path="dialogId">$DialogId</VALUE>
    </VALUES>
  </SEGdef>
 
 
  <SEGdef id="MsgHeadShort" version="2" delimiter="+" >
    <!-- "Nachrichtenkopf"beim Einlesen der Groesse
         Beachte: Kein Terminator angegeben, weil das Segment ja nicht ganz
         gelesen wird !!
    -->
    <GROUP type="SegHead" name="head" />
    <ELEM name="size" type="num" maxsize="12" leftfill="1" />
    <VALUES>
      <VALUE path="head/code">%code</VALUE>
      <VALUE path="head/version">%version</VALUE>
    </VALUES>
  </SEGdef>
 
 
  <SEGdef id="MsgTail" 
          code="GBTAIL" 
          version="1" 
          pversion="1"
          delimiter="+" 
          terminator="'"
  >
    <!-- "Nachrichtenabschluss" -->
    <GROUP type="SegHead" name="head" />
    <ELEM name="msgnum" type="num" maxsize="4" />
 
    <VALUES>
      <VALUE path="head/code">%code</VALUE>
      <VALUE path="head/version">%version</VALUE>
      <VALUE path="msgnum">$MessageNumber</VALUE>
    </VALUES>
  </SEGdef>
 
 
  <SEGdef id="SigHead" 
          version="3" 
          pversion="1"
          code="GBSIGHEAD" 
          mode="RDH"
          delimiter="+" 
          terminator="'"
  >
    <!-- "Signaturkopf" -->
    <GROUP type="SegHead" name="head" />
    <ELEM name="function" type="num" maxsize="3" />
    <ELEM name="ctrlref" type="ascii" maxsize="14" />
    <ELEM name="area" type="num" maxsize="3" />
    <ELEM name="role" type="num" maxsize="3" />
    <GROUP type="SecDetails" version="1" name="SecDetails"  />
    <ELEM name="signseq" type="num" maxsize="16" />
    <GROUP type="secstamp" name="SecStamp" version="1" />
    <GROUP type="hashalgo" name="HashAlgo" version="1" />
    <GROUP type="SignAlgo" version="1" name="SignAlgo" />
    <GROUP type="signkeyname" name="key" version="1" />
    <GROUP type="cert" name="cert" minnum="0" version="1" />
    
    <VALUES>
      <VALUE path="head/code">%code</VALUE>
      <VALUE path="head/version">%version</VALUE>
      <VALUE path="function">1</VALUE>
      <VALUE path="area">1</VALUE>
      <VALUE path="role">1</VALUE>
      <VALUE path="secstamp/stampcode">1</VALUE>
    </VALUES>
  </SEGdef>
 
 
  <SEGdef id="SigTail" 
          code="GBSIGTAIL" 
          version="1" 
          pversion="1"
          delimiter="+" 
          terminator="'"
  >
    <!-- "Signaturabschluss" -->
    <GROUP type="SegHead" name="head" />
    <ELEM name="ctrlref" type="ascii" maxsize="14" />
    <ELEM name="signature" type="bin" maxsize="512" />
 
    <VALUES>
      <VALUE path="head/code">%code</VALUE>
      <VALUE path="head/version">%version</VALUE>
    </VALUES>
  </SEGdef>
 
 
  <SEGdef id="CryptHead" 
          code="GBCRYPTHEAD"
          version="2" 
          pversion="1"
          delimiter="+"
          terminator="'"
          mode="RDH"
  >
    <!-- "Verschluesselungskopf fuer RDH" -->
    <GROUP type="SegHead" name="head" />
    <ELEM name="function" type="num" maxsize="3" />
    <ELEM name="role" type="num" maxsize="3" />
    <GROUP type="SecDetails" version="1" name="SecDetails" />
    <GROUP type="secstamp" name="SecStamp" version="1" />
    <GROUP type="CryptAlgo" name="CryptAlgo" version="1" />
    <GROUP type="CryptKeyName" name="key" version="1" />
    <ELEM name="compress" type="an" />
    <GROUP type="cert" name="cert" minnum="0" version="1" />
    
    <VALUES>
      <VALUE path="head/code">%code</VALUE>
      <VALUE path="head/version">%version</VALUE>
      <VALUE path="head/seq">998</VALUE>
      <VALUE path="function">4</VALUE>
      <VALUE path="role">1</VALUE>
      <VALUE path="secstamp/stampcode">1</VALUE>
      <VALUE path="compress">0</VALUE>
    </VALUES>
  </SEGdef>
 
 
  <SEGdef id="CryptData" 
          code="GBCRYPTDATA"
          version="1"
          pversion="1"
          delimiter="+"
          terminator="'"
  >
    <!-- "Verschluesselte Daten" -->
    <GROUP type="SegHead" name="head" />
    <ELEM name="CryptData" type="bin" />
 
    <VALUES>
      <VALUE path="head/code">%code</VALUE>
      <VALUE path="head/version">%version</VALUE>
      <VALUE path="head/seq">999</VALUE>
    </VALUES>
  </SEGdef>



  <SEGdef id="MsgResult" 
          code="GSMSGRES" 
          version="2" 
          pversion="1"
          delimiter="+" 
          terminator="'"
  >
   <!-- "Rueckmeldungen zur Gesamtnachricht" -->
   <GROUP type="SegHead" name="head"/>
   <GROUP type="result" name="result" version="1" maxnum="99" />

   <VALUES>
     <VALUE path="head/code">%code</VALUE>
     <VALUE path="head/version">%version</VALUE>
   </VALUES>
  </SEGdef>



  <SEGdef id="SegResult" 
          code="GSSEGRES" 
          pversion="1"
          version="2" 
          delimiter="+" 
          terminator="'"
  >
   <!-- "Rueckmeldungen zu Segmenten" -->
   <GROUP type="SegHead" name="head" />
   <GROUP type="result" name="result" version="1" maxnum="99" />

   <VALUES>
     <VALUE path="head/code">%code</VALUE>
     <VALUE path="head/version">%version</VALUE>
   </VALUES>
  </SEGdef>



 <SEGdef id="DialogEnd" 
         code="GBEND"
         version="1"
         pversion="1"
         delimiter="+" 
         terminator="'"
 >
   <GROUP type="SegHead" name="head" />
   <ELEM name="dialogid" type="ascii" maxsize="128" />
   
   <VALUES>
     <VALUE path="head/code">%code</VALUE>
     <VALUE path="head/version">%version</VALUE>
     <VALUE path="dialogid">$DialogId</VALUE>
   </VALUES>
 </SEGdef>



 <SEGdef id="Test" 
         code="GBTEST"
         version="1"
         pversion="1"
         delimiter="+" 
         terminator="'"
 >
   <GROUP type="SegHead" name="head" />
   
   <VALUES>
     <VALUE path="head/code">%code</VALUE>
     <VALUE path="head/version">%version</VALUE>
   </VALUES>
 </SEGdef>



 <SEGdef id="GetKey" 
         code="GCGETKEY" 
         version="2"
         pversion="1"
         delimiter="+" 
         terminator="'" 
         mode="RDH"
 >
   <GROUP type="SegHead" name="head" />
   <ELEM name="context" type="num" maxsize="1" />
   <ELEM name="id" type="num" maxsize="3" />
   <GROUP type="keyname" name="key" />
   <GROUP type="cert" name="cert" minnum="0" />
   
   <VALUES>
     <VALUE path="head/code">%code</VALUE>
     <VALUE path="head/version">%version</VALUE>
     <VALUE path="context">2</VALUE>
     <VALUE path="id">124</VALUE>
   </VALUES>
 </SEGdef>



 <SEGdef id="GetKeyResponse" 
         code="GSGETKEY" 
         version="2"
         pversion="1"
         delimiter="+" 
         terminator="'"
 >
   <GROUP type="SegHead" name="head" />
   <ELEM name="context" type="num" />
   <ELEM name="exchangeControl" type="ascii" />
   <ELEM name="msgnum" type="num" maxsize="4" />
   <ELEM name="id" type="num" />
   <GROUP name="keyname" type="keyname" />
   <GROUP name="key" type="key" />
   <GROUP name="cert" type="cert" minnum="0" />
   <VALUES>
     <VALUE path="head/code">%code</VALUE>
     <VALUE path="head/version">%version</VALUE>
     <VALUE path="context">1</VALUE>
     <VALUE path="id">224</VALUE>
   </VALUES>
 </SEGdef>



 <SEGdef id="OpenSession" 
         code="GCOPEN" 
         version="1"
         pversion="1"
         delimiter="+" 
         terminator="'" 
 >
   <GROUP type="SegHead" name="head" />
   <ELEM name="id" type="ascii" maxsize="32" />
   
   <VALUES>
     <VALUE path="head/code">%code</VALUE>
     <VALUE path="head/version">%version</VALUE>
   </VALUES>
 </SEGdef>


 <SEGdef id="OpenSessionResponse" 
         code="GSOPEN" 
         version="1"
         pversion="1"
         delimiter="+" 
         terminator="'" 
 >
   <GROUP type="SegHead" name="head" />
   <ELEM name="id" type="ascii" maxsize="32" />

   <VALUES>
     <VALUE path="head/code">%code</VALUE>
     <VALUE path="head/version">%version</VALUE>
   </VALUES>
 </SEGdef>



</SEGS>

